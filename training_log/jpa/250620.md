# ğŸ—“ï¸ 2025.06.20 (ê¸ˆ) â€“ êµìœ¡ ì¼ì§€

## ğŸ“š ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©
### JPA
#### Association Mapping
- Bidirection

#### JPQL(Java Persistence Query Language)
- JPQLì´ë€?
  - ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìˆëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬
  - SQLë¬¸ë³´ë‹¤ ê°„ê²°í•˜ë©° íŠ¹ì • DBMSì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - ë°©ì–¸ì„ í†µí•´ í•´ë‹¹ DBMSì— ë§ëŠ” SQLì„ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.
  - JPQLì€ find() ë©”ì†Œë“œë¥¼ í†µí•œ ì¡°íšŒì™€ ë‹¤ë¥´ê²Œ í•­ìƒ ë°ì´í„°ë² ì´ìŠ¤ì— SQLì„ ì‹¤í–‰í•´ì„œ ê²°ê³¼ë¥¼ ì¡°íšŒí•œë‹¤.
- JPQL ë¬¸ë²•
  - SELECT, UPDATE, DELETE ë“±ì˜ í‚¤ì›Œë“œ ì‚¬ìš©ì€ SQLê³¼ ë™ì¼í•œë‹¤.
  - INSERTëŠ” `persist()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•œë‹¤.
  - í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šì§€ë§Œ, ì—”í‹°í‹° ì†ì„±ì„ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•œë‹¤.
  - ì—”í‹°í‹° ë³„ì¹­ì„ í•„ìˆ˜ë¡œ ì‚¬ìš©í•´ì•¼ í•˜ë©° ë³„ì¹­ ì—†ì´ ì‘ì„±í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
- ì‚¬ìš© ë°©ë²•
  - (1) ì‘ì„±í•œ JPQL(ë¬¸ìì—´)ì„ `entityManager.createQuery()` ë©”ì†Œë“œë¥¼ í†µí•´ ì¿¼ë¦¬ ê°ì²´ë¡œ ë§Œë“ ë‹¤.
  - (2) `TypedQuery` ë˜ëŠ” `Query`ë¡œ ì¿¼ë¦¬ ê°ì²´ë¥¼ ë°˜í™˜ë°›ëŠ”ë‹¤.
    - `TypedQuery` : ë°˜í™˜í•  íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•˜ëŠ” ë°©ì‹ì¼ ë•Œ ì‚¬ìš©. ì¿¼ë¦¬ ê°ì²´ì˜ ë©”ì†Œë“œ ì‹¤í–‰ ê²°ê³¼ë¡œ ì§€ì •í•œ íƒ€ì…ì´ ë°˜í™˜ëœë‹¤.
    - `Query` : ë°˜í™˜í•  íƒ€ì…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ì—†ì„ ë•Œ ì‚¬ìš©. ì¿¼ë¦¬ ê°ì²´ ë©”ì†Œë“œì˜ ì‹¤í–‰ ê²°ê³¼ë¡œ Object ë˜ëŠ” Object[]ì´ ë°˜í™˜ëœë‹¤.
  - (3) ì¿¼ë¦¬ ê°ì²´ì—ì„œ ì œê³µí•˜ëŠ” ë©”ì†Œë“œì¸ `getSingleResult()` ë˜ëŠ” `getResultList()`ë¥¼ í˜¸ì¶œí•´ì„œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì¡°íšŒí•œë‹¤.
    - `getSingleResult()` : ê²°ê³¼ê°€ ì •í™•íˆ í•œ í–‰ì¼ ê²½ìš° ì‚¬ìš©í•˜ë©° ì—†ê±°ë‚˜ ë§ìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
    - `getResultList()` : ê²°ê³¼ê°€ 2í–‰ ì´ìƒì¼ ê²½ìš° ì‚¬ìš©í•˜ë©° ì»¬ë ‰ì…˜ì„ ë°˜í™˜í•œë‹¤. ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ì»¬ë ‰ì…˜ì„ ë°˜í™˜í•œë‹¤.
  - ì˜ˆì‹œ
    - ë‹¨ì¼ ì¡°íšŒ
      ```
      public String selectSingleMenuByTypedQuery() {
        String jpql = "SELECT m.menuName FROM Section01Menu as m WHERE m.menuCode = 8";
        TypedQuery<String> query = entityManager.createQuery(jpql, String.class);
        String resultMenuName = query.getSingleResult();
  
        return resultMenuName;
      }
      ```
    - ë‹¤ì¤‘ ì¡°íšŒ
      ```
      public List<Menu> selectMultiRowByTypedQuery() {
        String jpql = "SELECT m FROM Section01Menu as m";
        TypedQuery<Menu> query = entityManager.createQuery(jpql, Menu.class);
        List<Menu> resultMenuList = query.getResultList();
  
        return resultMenuList;
      }
      ```
- parameter binding
  - ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
    - :(ì½œë¡ ) ë‹¤ìŒì— ì´ë¦„ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ì§€ì •
    - ì˜ˆì‹œ
      ```
      public List<Menu> selectMenuByBindingName (String menuName) {
        String jpql = "SELECT m FROM Section02Menu m WHERE m.menuName = :menuName";
        List<Menu> resultMenuList = entityManager.createQuery(jpql, Menu.class)
                .setParameter("menuName", menuName)
                .getResultList();

        return resultMenuList;
      }
      ```
  - ìœ„ì¹˜ ê¸°ì¤€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
    - ?(ìœ„ì¹˜ í™€ë”) ë‹¤ìŒì— ìœ„ì¹˜ ê°’ì„ ì§€ì •
    - ìœ„ì¹˜ ê°’ì€ 1ë¶€í„° ì‹œì‘í•œë‹¤.
    - ì˜ˆì‹œ
      ```
      public List<Menu> selectMenuByBindingPosition (String menuName) {
        String jpql = "SELECT m FROM Section02Menu m WHERE m.menuName = ?1";
        List<Menu> resultMenuList = entityManager.createQuery(jpql, Menu.class)
                .setParameter(1, menuName)
                .getResultList();

        return resultMenuList;
      }
      ```
- projection
  - SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ
  - `SELECT {í”„ë¡œì ì…˜ ëŒ€ìƒ} FROM`
  - ì—”í‹°í‹° í”„ë¡œì ì…˜ : ì—”í‹°í‹° ìì²´ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ì‹
    ```
    public List<Menu> singleEntityProjection() {
        String jpql = "SELECT m FROM Member m";

        return entityManager.createQuery(jpql, Menu.class).getResultList();
    }
    ```
    - `Member` ì—”í‹°í‹° ì „ì²´ê°€ ì¡°íšŒë¨
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê´€ë¦¬ëœë‹¤.
  - ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜ : ì—”í‹°í‹° ì•ˆì— ìˆëŠ” `@Embede` íƒ€ì…ì„ ì¡°íšŒí•˜ëŠ” ë°©ì‹
    ```
    public List<Object[]> embededTypeProjection() {
        String jpql = "SELECT m.address FROM Member m";

        return entityManager.createQuery(jpql).getResultList();
    }
    ```
    - Memberì˜ address í•„ë“œëŠ” @Embeded íƒ€ì…
    - í”„ë¡œì ì…˜ ê²°ê³¼ë¡œ Address íƒ€ì… ê°ì²´ê°€ ë°˜í™˜ëœë‹¤.
    - ì—”í‹°í‹°ëŠ” ì•„ë‹ˆë¯€ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤.
  - ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜ : íŠ¹ì • í•„ë“œ ê°’ë§Œ ì¡°íšŒí•˜ëŠ” ë°©ì‹(íƒ€ì… ì•ˆì •ì„± ë–¨ì–´ì§)
    ```
    public List<Object[]> scalaTypeProjection() {
        String jpql = "SELECT c.categoryCode, c.categoryName FROM Section03Category c";

        return entityManager.createQuery(jpql).getResultList();
    }
    ```
    - ê²°ê³¼ëŠ” Object[] (ì˜ˆì‹œ : [["ë¯¼ì§€", 40], ["ë¯¼ìˆ˜", 50]])
    - íƒ€ì… ì•ˆì •ì„±ì´ ë–¨ì–´ì§€ê³ , ë‹¤ë£¨ê¸° ë¶ˆí¸í•˜ë‹¤.
    - ì—”í‹°í‹°ëŠ” ì•„ë‹ˆë¯€ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤.
  - new ëª…ë ¹ì–´ë¥¼ í™œìš©í•œ í”„ë¡œì ì…˜ : DTO ê°ì²´ë¡œ ê²°ê³¼ë¥¼ ë°”ë¡œ ë§¤í•‘í•˜ëŠ” ë°©ì‹(íƒ€ì… ì•ˆì •ì )
    ```
    public List<CategoryInfo> newCommandProjection() {
        // ì¼ë°˜ í´ë˜ìŠ¤ë¡œ ë§¤í•‘ (í•„ë“œ ê°’ì„ ê°€ì§€ëŠ” ìƒì„±ìë¡œ)
        String jpql = "SELECT new com.jpql.section03.projection.CategoryInfo(c.categoryCode, c.categoryName)"
                + "FROM Section03Category c";

        return entityManager.createQuery(jpql, CategoryInfo.class).getResultList();
    }
    ```
    - new í‚¤ì›Œë“œë¥¼ í†µí•´ ê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    - ê°ì²´ì˜ í’€ í´ë˜ìŠ¤ëª…ìœ¼ë¡œ ê¸°ìˆ í•´ì£¼ì–´ì•¼ í•œë‹¤.
    - `CategoryInfo` í´ë˜ìŠ¤ì— í•´ë‹¹í•˜ëŠ” ìƒì„±ìê°€ ë°˜ë“œì‹œ ìˆì–´ì•¼ í•œë‹¤.
    - ê²°ê³¼ëŠ” `List<CategoryInfo>`ë¡œ ë°›ëŠ”ë‹¤.
    - íƒ€ì… ì•ˆì •ì„±, ê°€ë…ì„±, ê°ì²´ì§€í–¥ì ì¸ ì½”ë“œë¥¼ ì§€í‚¬ ìˆ˜ ìˆë‹¤.
    - ì—”í‹°í‹°ëŠ” ì•„ë‹ˆë¯€ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê´€ë¦¬ë˜ì§€ ì•ŠëŠ”ë‹¤.
- paging
  - ë°ì´í„°ê°€ ë§ì„ ë•Œ í•œ ë²ˆì— ë‹¤ ê°€ì ¸ì˜¤ì§€ ì•Šê³ , ì¼ì • ë‹¨ìœ„ë¡œ ë‚˜ìš°ì–´ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ê¸°ëŠ¥
  - íŠ¹íˆ ëª©ë¡ ì¡°íšŒ í™”ë©´, ë¬´í•œ ìŠ¤í¬ë¡¤, í˜ì´ì§€ë„¤ì´ì…˜ ë“±ì—ì„œ ìì£¼ ì“°ì„
  - ì˜ˆì‹œ
    ```
    public List<Menu> usingPagingAPI(int offset, int limit) {
        String jpql = "SELECT m FROM Section04Menu m ORDER BY m.menuCode DESC";

        List<Menu> pagingMenuList = entityManager.createQuery(jpql, Menu.class)
                .setFirstResult(offset) // ì¡°íšŒë¥¼ ì‹œì‘í•  ìœ„ì¹˜(0ë¶€í„°) == offset
                .setMaxResults(limit) // ì¡°íšŒí•  ë°ì´í„°ì˜ ê°œìˆ˜ == limit
                .getResultList();

        return pagingMenuList;
    }
    ```
    - `setFirstResult(int offset)` : ê°€ì ¸ì˜¬ ë°ì´í„°ì˜ ì‹œì‘ ìœ„ì¹˜(0ë¶€í„° ì‹œì‘)
    - `setMaxResults(int limit)` : í•œ ë²ˆì— ê°€ì ¸ì˜¬ ë°ì´í„° ê°œìˆ˜
## ğŸ’» ì‹¤ìŠµ ì˜ˆì‹œ
### JPA
- [bidirection](../../JPA/chapter03-association-mapping/src/main/java/com/associationmapping/section03)
- [jpql](../../JPA/chapter04-jpql)

## âœï¸ ì˜¤ëŠ˜ì˜ íšŒê³ 
- 