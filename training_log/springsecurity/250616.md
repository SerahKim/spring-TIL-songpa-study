# ğŸ—“ï¸ 2025.06.16 (ì›”) â€“ êµìœ¡ ì¼ì§€

## ğŸ“š ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©
### Spring Security
- Spring Securityë€?
  - ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ, íŠ¹íˆ ì¸ì¦(Authentication)ê³¼ ì¸ê°€(Authorization)ì„ ë‹´ë‹¹í•˜ëŠ” Springì˜ ê°•ë ¥í•œ í”„ë ˆì„ ì›Œí¬
  - ì¸ì¦ê³¼ ê¶Œí•œì— ëŒ€í•œ ë¶€ë¶„ì„ Filterì˜ íë¦„ì— ë”°ë¼ì„œ ì²˜ë¦¬
  - ë³´ì•ˆê³¼ ê´€ë ¨ëœ ì˜µì…˜ì„ ì²´ê³„ì ìœ¼ë¡œ ì œê³µí•˜ë¯€ë¡œ ê°œë°œìê°€ ì¼ì¼ì´ ë³´ì•ˆê³¼ ê´€ë ¨ëœ ë¡œì§ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì ì´ ìˆë‹¤.
- Spring Security ë™ì‘ íë¦„
  - ![img.png](img/SpringSecurityArchitecture.png)
    - (1) ì‚¬ìš©ìì˜ ìš”ì²­ì´ ì„œë²„ë¡œ ë“¤ì–´ì˜´
    - (2) Authentication Filterê°€ ìš”ì²­ì„ ê°€ë¡œì±„ê³  Authotication Managerë¡œ ìš”ì²­ ìœ„ì„
    - (3) Authentication ManagerëŠ” ë“±ë¡ëœ Authotication Providerë¥¼ ì¡°íšŒí•˜ë©° ì¸ì¦ ìš”êµ¬
    - (4) Authentication Providerê°€ ì‹¤ì œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ì—¬ UserDetails ê²°ê³¼ë¥¼ ëŒë ¤ì¤Œ
    - (5) ê²°ê³¼ëŠ” SecurityContextHolderì— ì €ì¥ì´ ë˜ì–´ ì €ì¥ëœ ìœ ì € ì •ë³´ë¥¼ Spring Controllerì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë¨.
- Spring Securityê°€ ì‘ë™í•˜ëŠ” ë‚´ë¶€ êµ¬ì¡° (AuthenticationFilter ë‚´ë¶€ì˜ ë™ì‘ íë¦„)
  - ![img_1.png](img/innerFlow.png)
    - (1) ì‚¬ìš©ìê°€ ìê²© ì¦ëª… ì •ë³´ë¥¼ ì œì¶œí•˜ë©´ AbstractAuthenticationProcessingFilterê°€ Authentication ê°ì²´ ìƒì„±
    - (2) Authentication ê°ì²´ê°€ AuthenticationManagerì—ê²Œ ì „ë‹¬ë¨.
    - (3) ì¸ì¦ ì‹¤íŒ¨ ì‹œ
      - (3-1) SecurityContextHolderì˜ ê°’ì´ ì§€ì›Œì§
      - (3-2) RememberMeService.joinFail()ì´ ì‹¤í–‰ë¨.
      - (3-3) AuthenticationFailureHandler ì‹¤í–‰
    - (4) ì¸ì¦ ì„±ê³µ ì‹œ
      - (4-1) SessionAuthenticationStrategyê°€ ìƒˆë¡œìš´ ë¡œê·¸ì¸ì´ ë˜ì—ˆìŒì„ ì•Œë¦¼
      - (4-2) Authenticationì´ SecurityContextHolderì— ì €ì¥
      - (4-3) SecurityContextPersistenceFilterê°€ SecurityContextë¥¼ HttpSessionì— ì €ì¥í•˜ë©´ì„œ ë¡œê·¸ì¸ ì„¸ì…˜ ì •ë³´ê°€ ì €ì¥ë¨.
      - (4-4) RememberMeServices.loginSUccess() ì‹¤í–‰
      - (4-5) ApplicationEventPublisherê°€ InteractiveAuthenticationSuccessEventë¥¼ ë°œìƒì‹œí‚¤ê³  AuthenticationSuccessHandlerê°€ ì‹¤í–‰ë¨
- Spring Security ì„¤ì •
  - ì˜ì¡´ì„± ì¶”ê°€
    ```
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.thymeleaf.extras:thymeleaf-extras-springsecurity6'
    testImplementation 'org.springframework.security:spring-security-test'
    ```
    - Spring Security dependencyë¥¼ ë°›ì€ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì–´ë– í•œ ìš”ì²­ì´ë“  ì¸ì¦ì„ í•´ì•¼ë§Œ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆë‹¤.
  - Security Configuration í´ë˜ìŠ¤ ì„¤ì •
    - Beanìœ¼ë¡œ SecurityFilterChain ë“±ë¡
    - `@EnableWebSecurity`ë¥¼ í†µí•´ Spring Securityë¥¼ Spring ì• í”Œë¦¬ì¼€ì´ì…˜ì— í™œì„±í™”í•˜ëŠ” ì—­í• ì„ í•˜ë©°, SecurityFilterChainì„ ì§ì ‘ ì •ì˜í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.
    - ì˜ˆì‹œ
      ```
      @Configuration
      @EnableWebSecurity
      public class SecurityConfiguration {

      @Autowired
      private AuthFailHandler authFailHandler;
  
      // ë¹„ë°€ ë²ˆí˜¸ ì•”í˜¸í™”ë¥¼ ìœ„í•œ Spring Securityì—ì„œ ì œê³µí•˜ëŠ” interface
      @Bean
      public PasswordEncoder passwordEncoder() {
          return new BCryptPasswordEncoder(); // ì•”í˜¸í™”ë¥¼ ìœ„í•´ ê°€ì¥ ë§ì´ ì“°ëŠ” ì•Œê³ ë¦¬ì¦˜
      }
  
      @Bean
      public WebSecurityCustomizer webSecurityCustomizer() {
          // ì •ì ì¸ ë°ì´í„°ì—ëŠ” ë¬´ì‹œ
          return web -> web.ignoring()
                  .requestMatchers(PathRequest.toStaticResources().atCommonLocations());
      }
  
      @Bean
      public SecurityFilterChain configure(HttpSecurity http) throws Exception {
          /* ìš”ì²­ì— ëŒ€í•œ ê¶Œí•œ ì²´í¬ */
          http.authorizeHttpRequests( auth -> {
              auth.requestMatchers("/auth/login", "/user/signup", "/auth/fail", "/", "/main").permitAll(); // ê¶Œí•œì´ ì—†ì–´ë„ ì ‘ê·¼ ê°€ëŠ¥
              auth.requestMatchers("/admin/*").hasAnyAuthority(UserRole.ADMIN.getRole()); // "/admin/*" ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” UserRole.ADMIN.getRole() ê¶Œí•œì„ ê°€ì§€ê³  ìˆì–´ì•¼í•¨.
              auth.requestMatchers("/user/*").hasAnyAuthority(UserRole.USER.getRole());
              auth.anyRequest().authenticated(); // ë‹¤ë¥¸ ìš”ì²­ì— ëŒ€í•´ì„œëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ í—ˆìš© (permitAllê³¼ ë°˜ëŒ€)
          })
          ...
      }
      ```
  - Spring Security ì¸ì¦, ì¸ê°€ ì²˜ë¦¬
    - ì‚¬ìš©ì ì •ë³´ ê°ì²´ëŠ” UserDetailsë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤
    - UserDatailService ê°ì²´ë¥¼ í†µí•´ ì¸ì¦, ì¸ê°€ ì²˜ë¦¬ ë“±ì˜ ì‚¬ìš©ì ì •ë³´ ê´€ë¦¬ë¥¼ í•œë‹¤.
    - ê¶Œí•œ(Role) ì •ë³´ë„ ì´ ì•ˆì—ì„œ í•¨ê»˜ ì²˜ë¦¬ë¨
- ì „ì²´ íë¦„ ìš”ì•½
  - í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œê·¸ì¸ì„ ì‹œë„ â†’ AuthenticationManagerê°€ UserDetailsServiceë¥¼ í†µí•´ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ â†’ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ â†’ ê¶Œí•œ ë¶€ì—¬ â†’ ì¸ì¦ ì™„ë£Œ

## ğŸ’» ì‹¤ìŠµ ì˜ˆì‹œ
### Spring Security
- [session ë°©ì‹-spring-security](../../SPRINGSECURITY/chapter01-spring-security)

## âœï¸ ì˜¤ëŠ˜ì˜ íšŒê³ 
- ì•±ê°œë°œ ë‹¹ì‹œ ì§ì ‘ ì¸ì¦ ì •ë³´ë¥¼ ì ì—ˆë˜ ê²ƒì— ë¹„í•˜ë©´ Spring Securityë¥¼ í†µí•´ ë¹„êµì  ìˆ˜ì›”í•˜ê²Œ ë¡œê·¸ì¸ / íšŒì›ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ëŠê¼ˆë‹¤.
- í•˜ì§€ë§Œ ì„¤ì •ì„ ì™„ë²½íˆ ì´í•´í•˜ë ¤ë©´ ì•„ì§ ê°ˆ ê¸¸ì´ ë©€ë‹¤...